window.loadResources=function(o){return new Promise(function(e,t){function i(){++n===o.length&&e()}var n=0;o.forEach(function(e){var t,n,o,a=e.split("?")[0];/\.css/.test(a)?(t=e,n=i,(o=document.createElement("link")).rel="stylesheet",o.href=t,o.onload=n,document.head.appendChild(o)):/\.js/.test(a)&&(o=e,a=i,(e=document.createElement("script")).src=o,e.onload=a,document.head.appendChild(e))})})},jQuery(function(r){function t(){r(".wpum-multiselect:not(.wpum-clone-field)").select2({theme:"default"}),r(".wpum-datepicker:not([readonly]):not(.wpum-clone-field)").flatpickr({dateFormat:wpumFrontend.dateFormat})}var e={repeaters:{},init:function(){var t=this;r(".add-repeater-row").each(function(){var e=r(this).parents("fieldset");e.find(".fieldset-wpum_field_group").not(".fieldset-wpum_field_group-clone").length&&(e=e.get(0).classList[0],t.increaseInstance(e),t.validateMaxRows(e))}),r(".fieldset-wpum_field_group-clone :input").not(":button, :submit, :reset").each(function(){r(this).addClass("wpum-clone-field"),r(this).attr("data-clone",r(this).attr("id")),r(this).attr("data-name",r(this).attr("name")),r(this).attr("id",""),r(this).attr("name",""),r(this).removeAttr("required")}),r("body").on("click",".add-repeater-row",function(){var e=r(this).parents("fieldset");t.addNewInstance(e.get(0).classList[0])}),r("body").on("click",".remove-repeater-row",function(e){e.preventDefault();e=r(this).parents("fieldset");r(this).parents(".fieldset-wpum_field_group").remove(),t.setupInstances(e.get(0).classList[0])})},increaseInstance:function(e){this.repeaters[e]||this.resetInstance(e),this.repeaters[e]++},addNewInstance:function(e){this.addNewRepeaterRow(e),this.setupInstances(e),t()},resetInstance:function(e){this.repeaters[e]=0},addNewRepeaterRow:function(e){var t=r("."+e).find(".fieldset-wpum_field_group-clone").last();t.length&&this.validateMaxRows(e)&&((e=t.clone()).removeClass("fieldset-wpum_field_group-clone"),e.find(":input").not(":button, :submit, :reset").val("").prop("checked",!1).prop("selected",!1).removeClass("wpum-clone-field").trigger("change"),e.insertBefore(t))},setupInstances:function(e){var t=r("."+e).find(".fieldset-wpum_field_group").not(".fieldset-wpum_field_group-clone"),n=this;t.length&&(n.resetInstance(e),t.each(function(t){r(this).find(":input").each(function(){var e="",e=r(this).attr("data-name")?r(this).attr("data-name"):r(this).prop("name");r(this).attr("name",e.replace(new RegExp(/\[(.*?)\]/),function(){return"["+t+"]"})),0<t&&(e=(r(this).attr("data-clone")?r(this).attr("data-clone"):r(this).prop("id"))+"_"+t,r(this).attr("id",e),r(this).closest("fieldset").find("label").attr("for",e))}),n.increaseInstance(e)}))},validateMaxRows:function(e){var t=r("."+e),n=t.find(".fieldset-wpum_field_group").not(".fieldset-wpum_field_group-clone"),e=t.find(".add-repeater-row"),t=e.data("max-row");return!t||parseInt(t)<1||(n.length<parseInt(t)||(e.attr("disabled",!0),n.length<parseInt(t)))}};r(document).ready(function(){r(document.body).on("click",".wpum-remove-uploaded-file",function(){return r(this).closest(".wpum-uploaded-file").remove(),!1}),e.init(),t()}),removeProfileImage=function(e,t){r.post(wpumFrontend.ajaxurl,{type:e,nonce:r("#account_update_nonce").val(),action:"wpum_delete_profile_image"},function(e,t){})};var n=["plugin/filepond-encode.min.js","plugin/filepond-preview.css","plugin/filepond-preview.min.js","plugin/filepond-crop.min.js","plugin/filepond-resize.min.js","filepond.min.css","filepond.min.js"].map(function(e){return wpumFrontend.pluginurl+"assets/js/vendor/filepond/"+e});loadResources(n).then(function(){FilePond.registerPlugin(FilePondPluginFileEncode,FilePondPluginImagePreview,FilePondPluginImageCrop,FilePondPluginImageResize);const e=r(".fieldset-user_cover .wpum-uploaded-files input"),t=FilePond.create(r('.fieldset-user_cover input[type="file"]')[0],{stylePanelLayout:"compact square",server:{url:wpumFrontend.ajaxurl,process:{method:"POST",ondata:e=>(e.append("action","wpum_upload_profile_image"),e.append("key","user_cover"),e.append("nonce",r("#account_update_nonce").val()),e)},load:"?action=wpum_load_profile_image&type=user_cover_path&"}});0<e.length&&(t.files=[{source:e.val(),options:{type:"local",metadata:{poster:0<e.length?e.val():null}}}]);const n=r(".fieldset-user_avatar .wpum-uploaded-files input"),o=FilePond.create(r('.fieldset-user_avatar input[type="file"]')[0],{imageResizeTargetWidth:250,imageResizeTargetHeight:250,styleLoadIndicatorPosition:"center bottom",styleProgressIndicatorPosition:"center bottom",styleButtonRemoveItemPosition:"center bottom",styleButtonProcessItemPosition:"center bottom",stylePanelLayout:"compact circle",server:{url:wpumFrontend.ajaxurl,process:{method:"POST",ondata:e=>(e.append("action","wpum_upload_profile_image"),e.append("key","user_avatar"),e.append("nonce",r("#account_update_nonce").val()),e)},load:0<n.length?"?action=wpum_load_profile_image&type=current_user_avatar_path&":null}});0<n.length&&(o.files=[{source:n.val(),options:{type:"local",metadata:{poster:0<e.length?e.val():null}}}]);const a=document.querySelector(".fieldset-user_cover .filepond--root");a.addEventListener("FilePond:removefile",e=>{r(".fieldset-user_cover .wpum-uploaded-files").html(""),removeProfileImage("user_cover","")});const i=document.querySelector(".fieldset-user_avatar .filepond--root");i.addEventListener("FilePond:removefile",e=>{r(".fieldset-user_avatar .wpum-uploaded-files").html(""),removeProfileImage("current_user_avatar","")})})});
