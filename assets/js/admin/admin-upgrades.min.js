/*! WP User Manager - v2.0.0
 * http://wpusermanager.com
 * Copyright (c) 2018; * Licensed GPLv2+ */
jQuery(document).ready(function(a){const b={collection:{},get:function(a,b,c){return jQuery?(b=void 0!==b?b:void 0,c=!0===c,(void 0===this.collection[a]||c)&&(this.collection[a]=void 0!==b?jQuery(a,b):jQuery(a)),this.collection[a]):-1}};window.WPUM_Selector_Cache=b;var c={el:{},init:function(){this.submit(),this.dismiss_message()},submit:function(){var d=this;d.el.main_container=b.get("#wpum-db-updates"),d.el.update_link=b.get(".wpum-update-now",d.el.main_container),d.el.run_upload_container=b.get(".wpum-run-database-update",d.el.progress_main_container),d.el.progress_main_container=b.get(".progress-container",d.el.main_container),d.el.heading=b.get(".update-message",d.el.progress_main_container),d.el.progress_container=b.get(".progress-content",d.el.progress_main_container),d.el.update_progress_counter=b.get(a(".wpum-update-progress-count")),d.el.main_container.data("resume-update")&&(d.el.update_link.addClass("active").hide().removeClass("wpum-hidden"),a("#wpum-restart-upgrades").length||window.setTimeout(c.get_db_updates_info,1e3,d)),d.el.update_link.hasClass("active")||(d.el.update_link.on("click","",function(a){a.preventDefault(),d.el.run_upload_container.find(".notice").remove(),d.el.run_upload_container.append('<div class="notice notice-error non-dismissible wpum-run-update-containt"><p> <a href="#" class="wpum-run-update-button button">'+wpum_vars.db_update_confirmation_msg_button+"</a> "+wpum_vars.db_update_confirmation_msg+"</p></div>")}),a("#wpum-db-updates").on("click","a.wpum-run-update-button",function(b){return b.preventDefault(),!a(this).hasClass("active")&&(a(this).addClass("active").fadeOut(),d.el.update_link.addClass("active").fadeOut(),a("#wpum-db-updates .wpum-run-update-containt").slideUp(),d.el.progress_container.find(".notice-wrap").remove(),d.el.progress_container.append('<div class="notice-wrap wpum-clearfix"><span class="spinner is-active"></span><div class="wpum-progress"><div></div></div></div>'),d.el.progress_main_container.removeClass("wpum-hidden"),a.ajax({type:"POST",url:ajaxurl,data:{action:"wpum_run_db_updates",run_db_update:1},dataType:"json",success:function(a){}}),window.setTimeout(c.get_db_updates_info,500,d),!1)}))},get_db_updates_info:function(d){a.ajax({type:"POST",url:ajaxurl,data:{action:"wpum_db_updates_info"},dataType:"json",success:function(e){var f=b.get(".notice-wrap",d.el.progress_container,!0);-1!==a.inArray("success",Object.keys(e))?e.success?(d.el.update_progress_counter.length&&d.el.update_progress_counter.text("100%"),-1!==a.inArray("heading",Object.keys(e.data))&&d.el.heading.html("<strong>"+e.data.heading+"</strong>"),d.el.update_link.closest("p").remove(),f.html('<div class="notice notice-success is-dismissible"><p>'+e.data.message+'</p><button type="button" class="notice-dismiss"></button></div>')):(-1!==a.inArray("heading",Object.keys(e.data))&&d.el.heading.html("<strong>"+e.data.heading+"</strong>"),e.data.message?(d.el.update_link.closest("p").remove(),f.html('<div class="notice notice-error is-dismissible"><p>'+e.data.message+'</p><button type="button" class="notice-dismiss"></button></div>')):setTimeout(function(){d.el.update_link.removeClass("active").show(),d.el.progress_main_container.addClass("wpum-hidden")},1e3)):e&&-1!==a.inArray("percentage",Object.keys(e.data))?(d.el.update_progress_counter.length&&d.el.update_progress_counter.text(e.data.total_percentage+"%"),-1!==a.inArray("heading",Object.keys(e.data))&&d.el.heading.html("<strong>"+e.data.heading+"</strong>"),a(".wpum-progress div","#wpum-db-updates").animate({width:e.data.percentage+"%"},50,function(){}),window.setTimeout(c.get_db_updates_info,1e3,d)):(f.html('<div class="notice notice-error"><p>'+wpum_vars.updates.ajax_error+"</p></div>"),setTimeout(function(){d.el.update_link.removeClass("active").show(),d.el.progress_main_container.addClass("wpum-hidden")},1e3))}})},process_step:function(c,d,e){wpum_setting_edit=!0,a.ajax({type:"POST",url:ajaxurl,data:{action:"wpum_do_ajax_updates",step:parseInt(c),update:parseInt(d)},dataType:"json",success:function(c){wpum_setting_edit=!1;var d=b.get(".notice-wrap",e.el.progress_container,!0);-1!==a.inArray("success",Object.keys(c))?c.success?(-1!==a.inArray("heading",Object.keys(c.data))&&e.el.heading.html("<strong>"+c.data.heading+"</strong>"),e.el.update_link.closest("p").remove(),d.html('<div class="notice notice-success is-dismissible"><p>'+c.data.message+'</p><button type="button" class="notice-dismiss"></button></div>')):(-1!==a.inArray("heading",Object.keys(c.data))&&e.el.heading.html("<strong>"+c.data.heading+"</strong>"),d.html('<div class="notice notice-error"><p>'+c.data.message+"</p></div>"),setTimeout(function(){e.el.update_link.removeClass("active").show(),e.el.progress_main_container.addClass("wpum-hidden")},5e3)):c&&-1!==a.inArray("percentage",Object.keys(c.data))?(a(".wpum-progress div","#wpum-db-updates").animate({width:c.data.percentage+"%"},50,function(){}),-1!==a.inArray("heading",Object.keys(c.data))&&e.el.heading.html("<strong>"+c.data.heading.replace("{update_count}",e.el.heading.data("update-count"))+"</strong>"),e.process_step(parseInt(c.data.step),c.data.update,e)):(d.html('<div class="notice notice-error"><p>'+wpum_vars.updates.ajax_error+"</p></div>"),setTimeout(function(){e.el.update_link.removeClass("active").show(),e.el.progress_main_container.addClass("wpum-hidden")},5e3))}}).fail(function(a){wpum_setting_edit=!1,window.console&&window.console.log&&console.log(a),b.get(".notice-wrap",self.el.progress_container).append(a.responseText)}).always(function(){})},dismiss_message:function(){a("body").on("click","#poststuff .notice-dismiss",function(){a(this).parent().slideUp("fast")})}};c.init(),{init:function(){this.restartUpgrade(),this.stopUpgrade(),this.restartUpdater()},restartUpgrade:function(){jQuery("#wpum-restart-upgrades").click("click",function(a){var b=this;a.preventDefault(),jQuery(".wpum-doing-update-text-p").show(),jQuery(".wpum-update-paused-text-p").hide(),window.location.assign(jQuery(b).data("redirect-url"))})},stopUpgrade:function(){jQuery("#wpum-pause-upgrades").click("click",function(a){var b=this;a.preventDefault(),jQuery(".wpum-doing-update-text-p").hide(),jQuery(".wpum-update-paused-text-p").show(),window.location.assign(jQuery(b).data("redirect-url"))})},restartUpdater:function(){jQuery(".wpum-restart-updater-btn,.wpum-run-update-now").click("click",function(a){var b=this;a.preventDefault(),window.location.assign(jQuery(b).attr("href"))})}}.init()});